# This configuration file is used by Travis CI to build/test TECA.
language: c++
sudo: required

services:
  - docker

before_install:
  - docker pull aaelbashandy/travis_ci_teca:0.03
  - >
    docker run -v $TRAVIS_BUILD_DIR:/travis_host -u cascade aaelbashandy/travis_ci_teca:0.02 /bin/bash -c 
    "source /teca_deps/2.1.3/bin/teca_env.sh &&
    export LD_LIBRARY_PATH=/teca_deps/2.1.3/lib/:/teca_deps/2.1.3/lib64/:/project/TECA_build/lib:$LD_LIBRARY_PATH &&
    export PYTHONPATH=/teca_deps/2.1.3/lib:/teca_deps/2.1.3/lib/python2.7/site-packages/:/project/TECA_build/lib:$PYTHONPATH &&
    svn co svn://missmarple.lbl.gov/work3/teca/TECA_data TECA_data && cd TECA_build/ &&
    cmake -DBUILD_TESTING=ON -DTECA_DATA_ROOT=/project/TECA_data/ -DCMAKE_BUILD_TYPE=Debug
    -DCMAKE_INSTALL_PREFIX=/teca_deps/2.1.3 -DBOOST_ROOT=/teca_deps/2.1.3/include/
    -DNETCDF_DIR=/teca_deps/2.1.3 -DTECA_PYTHON_VERSION=2 /travis_host &&
    make -j4 && ctest -I 19,19,1 -V"


script: ctest -I -V

after_failure:
  - cat build/Testing/Temporary/LastTest.log
